<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <!-- Spring Security CSRF (있으면 채워짐) -->
  <meta name="_csrf" th:content="${_csrf?.token}" />
  <meta name="_csrf_header" th:content="${_csrf?.headerName}" />

  <!-- 현재 로그인 유저 (Thymeleaf가 안 돌아도 기본값이 들어있게) -->
  <meta name="current-user-id" content="1" th:content="${currentUserId}" />
  <meta name="current-user-name" content="사용자 1" th:content="${currentUserName}" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">

  <style>
    body { background-color: #f8f9fa; }
    #calendar { min-height: 80vh; }
    .sidebar-card { max-height: 85vh; overflow-y: auto; }
    .group-item:hover { background-color: #f8f9ff; }
  </style>

  <title>Main</title>
</head>

<body>

<!-- 상단 헤더: "~님의 일정" -->
<header class="border-bottom bg-white mb-3">
  <div class="container-fluid py-3 d-flex justify-content-between align-items-center">
    <div>
      <h4 class="mb-0">
        <!-- ✅ Thymeleaf가 안 돌아도 "사용자 1"이 보이도록 기본 텍스트를 넣음 -->
        <span th:text="${currentUserName}">사용자 1</span>님의 일정
      </h4>
      <small class="text-muted">개인 + 그룹 일정 한 번에 보기</small>
    </div>

    <div class="d-flex gap-2">
      <button id="btn-header-add-schedule" class="btn btn-primary btn-sm">일정 추가</button>
      <button id="btn-header-add-group" class="btn btn-outline-secondary btn-sm">그룹 추가</button>
    </div>
  </div>
</header>

<div class="container-fluid">
  <div class="row g-3">

    <!-- LEFT: 내 일정 + 내 그룹 -->
    <aside class="col-12 col-lg-3">
      <div class="card shadow-sm sidebar-card mb-3">
        <div class="card-body">

          <!-- 1. 나의 일정 -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">나의 일정 (다가오는 순)</h6>
            <button id="btn-side-add-schedule" class="btn btn-sm btn-outline-primary">+ 추가</button>
          </div>

          <ul id="myScheduleList" class="list-group small mb-3"></ul>

          <hr class="my-3"/>

          <!-- 2. 내 그룹 -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">내 그룹</h6>
            <div class="btn-group btn-group-sm" role="group">
              <button id="btnCheckAllGroups" class="btn btn-outline-secondary">전체</button>
              <button id="btnUncheckAllGroups" class="btn btn-outline-secondary">해제</button>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-2">
            <small class="text-muted">
              체크된 그룹 일정만 달력에 표시됩니다. (개인 일정은 항상 표시)
            </small>
            <button id="btn-side-add-group" class="btn btn-sm btn-outline-success ms-2">+ 그룹</button>
          </div>

          <ul id="myGroupList" class="list-group small"></ul>
        </div>
      </div>
    </aside>

    <!-- RIGHT: 달력 -->
    <main class="col-12 col-lg-9">
      <div class="card shadow-sm">
        <div class="card-body">
          <div id="calendar"></div>
        </div>
      </div>
    </main>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

<!-- ✅ Thymeleaf가 안 돌아도 main.js가 로드되게 기본 src를 같이 둠 -->
<script src="/js/main.js" th:src="@{/js/main.js}"></script>

</body>
</html>
